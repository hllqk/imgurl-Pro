<?php
 defined('BASEPATH') OR exit('No direct script access allowed'); class Home extends CI_Controller{ protected $notice; protected $footer; public function __construct(){ parent::__construct(); $lock_file = FCPATH.'data/install.lock'; $this->load->helper('basic'); ip_block(); $this->load->model('query','',TRUE); $this->notice = $this->query->options('notice')->values; $this->footer = $this->query->options('footer')->values; $this->load->library("basic"); $this->basic->load(); if(!is_file($lock_file)){ header("location:/install/"); exit; } } public function index(){ $this->load->model('query','',TRUE); $siteinfo = $this->query->site_setting(); $conf = $this->basic->conf("info"); $siteinfo = json_decode($siteinfo->values); $siteinfo->info = $conf->index_info; $siteinfo->storage = $this->query->list_storage(); $siteinfo->notice = $this->notice; $siteinfo->footer = $this->footer; $this->load->view('user/header.php',$siteinfo); $this->load->view('user/home.php',$siteinfo); $this->load->view('user/footer.php'); } public function multiple(){ $this->load->model('query','',TRUE); $siteinfo = $this->query->site_setting(); $siteinfo = json_decode($siteinfo->values); $siteinfo->notice = $this->notice; $siteinfo->footer = $this->footer; $siteinfo->storage = $this->query->list_storage(); $this->load->view('user/header.php',$siteinfo); $this->load->view('user/multiple.php',$siteinfo); $this->load->view('user/footer.php'); } public function log(){ $this->load->model('query','',TRUE); $siteinfo = $this->query->site_setting(); $siteinfo = json_decode($siteinfo->values); $siteinfo->footer = $this->footer; $siteinfo->title = "ImgURL更新日志"; $this->load->view('user/header.php',$siteinfo); $this->load->view('user/log.php'); $this->load->view('user/footer.php'); } public function upload_num(){ $this->load->view('user/upload_num'); } public function sitemap(){ $page_path = FCPATH.'data/pages'; $pages = scandir($page_path); foreach ($pages as $page) { if(($page === '.') OR ($page === '..')){ continue; } $page = str_replace('.md','',$page); echo "<li><a href = '/page/{$page}'>{$page}</a></li>"; } $this->load->view('user/sitemap.php'); } } ?>