<?php
 defined('BASEPATH') OR exit('No direct script access allowed'); class Setting extends CI_Controller{ public function __construct(){ parent::__construct(); $this->load->library("basic"); $this->basic->load(); $this->load->model('query','',TRUE); $this->load->helper('basic'); $info = $this->query->userinfo()->values; $info = json_decode($info); is_login($info->username,$info->password); } public function site(){ $siteinfo = $this->query->site_setting(); $siteinfo = json_decode($siteinfo->values); $siteinfo->site = $siteinfo; $siteinfo->notice = $this->query->options('notice'); $siteinfo->footer = $this->query->options('footer'); $siteinfo->page_notice = $this->query->options('page_notice'); $siteinfo->admin_title = '站点设置'; $this->load->view('admin/header',$siteinfo); $this->load->view('admin/left'); $this->load->view('admin/site'); $this->load->view('admin/footer'); } public function uplimit(){ $siteinfo = $this->query->option('uplimit'); $siteinfo = json_decode($siteinfo->values); if($siteinfo->limit != 0){ $switch = 'checked'; } else{ $switch = ''; } $siteinfo->admin_title = '上传限制'; $siteinfo->switch = $switch; $this->load->view('admin/header',$siteinfo); $this->load->view('admin/left'); $this->load->view('admin/uplimit'); $this->load->view('admin/footer'); } public function compress(){ $data['admin_title'] = '图片压缩'; $this->load->model('query','',TRUE); $tinypng = $this->query->option('tinypng'); $data['switch'] = $tinypng->switch; if($data['switch'] == 'OFF'){ $data['switch'] = ''; } else{ $data['switch'] = 'checked'; } $data['values'] = json_decode($tinypng->values); $this->load->view('admin/header',$data); $this->load->view('admin/left'); $this->load->view('admin/tinypng',$data); $this->load->view('admin/footer'); } public function picture(){ $data['admin_title'] = '图片处理'; $this->load->model('query','',TRUE); $tinypng = $this->query->option('tinypng'); $data['switch'] = $tinypng->switch; if($data['switch'] == 'OFF'){ $data['tinypng']['switch'] = ''; } else{ $data['tinypng']['switch'] = 'checked'; } $data['tinypng']['values'] = json_decode($tinypng->values); $moderate = $this->query->option('moderate'); $data['switch'] = $moderate->switch; $data['moderate']['values'] = $moderate->values; if($data['switch'] == 'OFF'){ $data['moderate']['switch'] = ''; } else{ $data['moderate']['switch'] = 'checked'; } $this->load->view('admin/header',$data); $this->load->view('admin/left'); $this->load->view('admin/picture',$data); $this->load->view('admin/footer'); } public function identify(){ $data['admin_title'] = '图片鉴黄'; $this->load->model('query','',TRUE); $moderate = $this->query->option('moderate'); $data['switch'] = $moderate->switch; $data['values'] = $moderate->values; if($data['switch'] == 'OFF'){ $data['switch'] = ''; } else{ $data['switch'] = 'checked'; } $this->load->view('admin/header',$data); $this->load->view('admin/left'); $this->load->view('admin/identify'); $this->load->view('admin/footer'); } public function token(){ $data['admin_title'] = 'token管理'; $data['token'] = $this->query->read_token(); if($data['token']->switch == 'OFF'){ $data['token']->switch = ''; } else{ $data['token']->switch = 'checked'; } $this->load->view('admin/header',$data); $this->load->view('admin/left'); $this->load->view('admin/token'); $this->load->view('admin/footer'); } public function ipblock(){ $data['admin_title'] = 'IP黑名单'; $data['ips'] = file_get_contents(FCPATH.'/data/ipblock.txt'); $this->load->view('admin/header',$data); $this->load->view('admin/left'); $this->load->view('admin/ipblock',$data); $this->load->view('admin/footer'); } } ?>