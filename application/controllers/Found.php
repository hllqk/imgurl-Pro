<?php
 defined('BASEPATH') OR exit('No direct script access allowed'); class Found extends CI_Controller{ public function __construct(){ parent::__construct(); $this->load->model('query','',TRUE); } public function _remap($type = 'all',$params = array()) { $page = @$params[0]; if(!isset($page)){ $page = 0; } $this->index($type,$page); } public function index($type = 'all',$page = 0){ $this->load->library('basic'); $data['is_login'] = $this->basic->is_login(); $siteinfo = $this->query->site_setting(); $siteinfo = $siteinfo->values; $siteinfo = json_decode($siteinfo); $limit = 16; if($page == 0){ $siteinfo->title = $siteinfo->title.'，探索发现'; } else{ $page_num = $page / 16 + 1; $siteinfo->title = $siteinfo->title.'，探索发现 - '."第{$page_num}页"; } switch($type){ case 'all': $num = $this->query->count_num('visitor')->num; $num = ($num >= 160) ? 160 : $num; $config['base_url'] = "/found/all/"; break; case 'gif': $num = $this->query->count_num('gif')->num; $num = ($num >= 160) ? 160 : $num; $config['base_url'] = "/found/gif/"; break; case 'views': $num = $this->query->count_num('visitor')->num; $num = ($num >= 160) ? 160 : $num; $config['base_url'] = "/found/views/"; break; case 'large': $num = $this->query->count_num('large')->num; $num = ($num >= 160) ? 160 : $num; $config['base_url'] = "/found/large/"; break; default: $num = $this->query->count_num('visitor')->num; $num = ($num >= 160) ? 160 : $num; $config['base_url'] = "/found/all/"; break; } $data['imgs'] = $this->query->found_img($type,$page); $data['domain'] = $this->query->domain('localhost'); $data['b2_domain'] = $this->query->domain('backblaze'); $data['cos_domain'] = $this->query->domain('cos'); $data['ftp_domain'] = $this->query->domain('ftp'); $data['qiniu_domain'] = $this->query->domain('qiniu'); $data['footer'] = $this->query->options('footer')->values; $this->load->library('pagination'); $config['total_rows'] = $num; $config['per_page'] = $limit; $config['first_url'] = 0; $config['first_link'] = '首页'; $config['last_link'] = '尾页'; $config['attributes'] = array('class' => 'paging'); $config['next_link'] = '下一页'; $config['prev_link'] = '上一页'; $this->pagination->initialize($config); $data['page'] = $this->pagination->create_links(); $this->load->view('user/header',$siteinfo); $this->load->view('user/found',$data); $this->load->view('user/footer',$data); } public function link($id){ $id = strip_tags($id); $id = (int)$id; $siteinfo = $this->query->site_setting(); $siteinfo = $siteinfo->values; $siteinfo = json_decode($siteinfo); $data['imgs'] = $this->query->found(32); $data['domain'] = $this->query->domain('localhost'); $this->load->view('user/header',$siteinfo); $this->load->view('user/link',$data); $this->load->view('user/footer'); } } ?>