<?php
 defined('BASEPATH') OR exit('No direct script access allowed'); class Img extends CI_Controller{ public function _remap($imgid){ $this->load->model('query','',TRUE); $siteinfo = $this->query->site_setting(); $siteinfo = json_decode($siteinfo->values); $this->load->library("basic"); $conf = $this->basic->conf("info"); $imgid = strip_tags($imgid); $id_length = strlen($imgid); if($id_length != 16){ show_404(); } $this->load->model('query','',TRUE); $this->load->model('update','',TRUE); $this->update->views($imgid); $imginfo = $this->query->onepic($imgid); $picinfo = $this->query->imginfo($imgid); $siteinfo->description = $picinfo->client_name.",由网友上传至ImgURL图床。"; @$domain = $this->query->domain($imginfo->storage); $footer = $this->query->options('footer')->values; if(!$domain){ show_404(); } $this->load->helper('basic'); $fullpath = FCPATH.$imginfo->path; switch ($imginfo->storage) { case 'localhost': $size = file_size($fullpath); break; case 'backblaze': case 'cos': case 'ftp': case 'qiniu': $size = round($picinfo->size).'Kb'; break; default: break; } $page_notice = $this->query->options('page_notice'); $datas = array( "logo" => $siteinfo->logo, "title" => $picinfo->client_name, "url" => $domain.$imginfo->path, "date" => $imginfo->date, "mime" => $picinfo->mime, "width" => $picinfo->width, "height" => $picinfo->height, "views" => $picinfo->views, "tags" => $picinfo->tags, "keywords" => $picinfo->client_name, "analytics" => $siteinfo->analytics, "description" => $siteinfo->description, "comments" => $siteinfo->comments, "ext" => $picinfo->ext, "size" => $size, "page_notice" => $page_notice, "footer" => $footer ); $datas['img_info'] = $conf->img_info; $datas['is_login'] = $this->basic->is_login(); $this->load->view('user/header',$datas); $this->load->view('user/img',$datas); $this->load->view('user/footer'); } } ?>